---
title: "Project draft"
author: "lucy and Jacob"
date: "4/5/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

## KNN with fake data
```{r}
library(ROCR)
library(class)

data.df <- read.csv("fake_data.csv")
set.seed(12345)
data.size <- nrow(data.df)
train.size <- .80
num.test.labels <- data.size*(1-train.size)


data.df$weather <- as.factor(data.df$weather)
levels(data.df$weather) <- c("Cloudy", "Sunny")

normalize.it <- function(vec) {
    y <- (vec - min(vec))/(max(vec) - min(vec))
    y
}
    
weather.lst <- lapply(data.df[ , 3:6], normalize.it)
data.weather.normed <- data.frame(weather.lst)
summary(data.weather.normed)

train.row.nums <- sample(1:data.size, data.size*train.size, replace = FALSE)
train.data <- subset(data.weather.normed[train.row.nums, ])

test.row.nums <- setdiff(1:data.size, train.row.nums)
test.data <- subset(data.weather.normed[test.row.nums, ])

class.labels <- data.df$weather[train.row.nums]
true.labels <- data.df$weather[test.row.nums]

knn.predict <- knn(train.data, test.data, class.labels, k=2)

num.incorrect.labels <- sum(knn.predict != true.labels)
misc.rate <- num.incorrect.labels/num.test.labels
misc.rate

conf.matrix <- table(knn.predict, true.labels)
conf.matrix
```

## KNN with real data
```{r}
library(ROCR)
library(class)

data.df <- read.csv("cleaned_data.csv")
set.seed(12345)
data.size <- nrow(data.df)
train.size <- .80
num.test.labels <- data.size*(1-train.size)


data.df$weather <- as.factor(data.df$weathertype)
levels(data.df$weathertype) <- c("Clear", "Clouds", "Rain", "Snow", "Thunderstorm")

normalize.it <- function(vec) {
    y <- (vec - min(vec))/(max(vec) - min(vec))
    y
}
    
weather.lst <- lapply(data.df[ , 3:8], normalize.it)
data.weather.normed <- data.frame(weather.lst)
summary(data.weather.normed)

train.row.nums <- sample(1:data.size, data.size*train.size, replace = FALSE)
train.data <- subset(data.weather.normed[train.row.nums, ])

test.row.nums <- setdiff(1:data.size, train.row.nums)
test.data <- subset(data.weather.normed[test.row.nums, ])

class.labels <- data.df$weathertype[train.row.nums]
true.labels <- data.df$weathertype[test.row.nums]

knn.predict <- knn(train.data, test.data, class.labels, k=5)

num.incorrect.labels <- sum(knn.predict != true.labels)
misc.rate <- num.incorrect.labels/num.test.labels
misc.rate

conf.matrix <- table(knn.predict, true.labels)
conf.matrix
```

## Logistic Regression (an attempt)
```{r} 
library(ROCR)
humid.glm <- glm(humidity~pressure, data = data.df)
humid.glm2 <- glm(humidity~pressure+cloudcov, data = data.df)
summary(humid.glm)
summary(humid.glm2)

plot(humidity~pressure, data=data.df)
plot(humidity~cloudcov, data=data.df)

data.size<-nrow(data.df)
train.size<-0.80

set.seed(12345)

train.row.nums<-sample(1:data.size, data.size*train.size, replace=FALSE)
train.data<-subset(data.df[train.row.nums,])

test.row.nums<-setdiff(1:data.size,train.row.nums)
test.data<-subset(data.df[test.row.nums,])

true.labels<-test.data[,1]

mod<-glm(humidity~pressure,data=train.data)
model.predictions<-predict(mod, newdata=test.data[,-1], type="response")

# using model predictions from the previous call to predict
pred<-prediction(model.predictions,true.labels)
# tpr- true positive rate, frp- false positive rate
perf<-performance(pred,'tpr','fpr')

plot(perf,main="ROC")
abline(0,1,lty=3) #Adds the x=y line, representing a random 50-50 prediction

```


## Linear Regression
```{r}
fit.weather <- lm(pressure~humidity, data=data.df)
#fit.weather <- as.vector(fit.weather)
fit.weather[2587,] <- (fit.weather[2586,]+fit.weather[2588,])/2
#summary(fit.weather)
test.data.press <- test.data[c("humidity")]
actual.scores <- test.data.pressure
fit.predicted <- predict(fit.weather, test.data.press, interval = "predict")
summary(fit.predicted)

fit2.weather <- lm(temp~., data = data.df)
#fit2.weather <- as.vector(fit2.weather)
fit2.weather[3864,] <- (fit.weather[3863,]+fit.weather[3865,])/2
#summary(fit2.weather)
test.data.temp <- test.data[c("temp", "pressure", "windspeed", "winddeg", "cloudcov")]
actual.scores2 <- test.data$temp
fit.predicted2 <- predict(fit2.weather, test.data.temp, interval = "predict")
summary(fit.predicted2)

fit.humid <- lm(humidity~pressure+cloudcov, data = data.df)
#fit.humid <- as.vector(fit.humid)
summary(fit.humid)
test.data.humid <- test.data[c("pressure", "humidity")]
actual.scores.humid <- test.data$humidity
fit.predicted.humid <- predict(fit.humid, test.data.humid, interval = "predict")
summary(fit.humid)
```


#Time Series 
```{r}
library(ggplot2)
library(fracdiff)
library(forecast)
weather.vec <- as.vector(data.df$temp)
#remove outlier by averaging point before and after
weather.vec[3864:3865] <- ((weather.vec[3863]+weather.vec[3866])/2)
weather.ts <- ts(weather.vec, frequency = 8760)
plot.ts(weather.ts, main = "Temperature Time Series Graph", ylab = "Temperature in Kelvin")
weather.pred <- HoltWinters(weather.ts, beta = FALSE, gamma = FALSE)
weather.pred2 <- forecast:::forecast.HoltWinters(weather.pred, h=120)
forecast:::plot.forecast(weather.pred2)
hist(residuals(weather.pred2))

wind.vec <- as.vector(data.df$windspeed)
#remove outlier by averaging point before and after
#weather.vec[3864:3865] <- ((weather.vec[3863]+weather.vec[3866])/2)
wind.ts <- ts(wind.vec, frequency = 8760)
plot.ts(wind.ts, main = "Wind Speed Time Series Graph", ylab = "Wind Speed")
wind.pred <- HoltWinters(wind.ts, beta = FALSE, gamma = FALSE)
wind.pred2 <- forecast:::forecast.HoltWinters(wind.pred, h = 120)
forecast:::plot.forecast(wind.pred2)
hist(residuals(wind.pred2))

pressure.vec <- as.vector(data.df$pressure)
pressure.vec[1097:1098] <- (pressure.vec[1096]+pressure.vec[1099])/2
pressure.vec[2417:2418] <- (pressure.vec[2416]+pressure.vec[2419])/2
pressure.vec[2587:2588] <- (pressure.vec[2586]+pressure.vec[2589])/2
pressure.ts <- ts(pressure.vec, frequency = 8760)
press.pred <- HoltWinters(pressure.ts, beta = FALSE, gamma = FALSE)
press.pred2 <- forecast:::forecast.HoltWinters(press.pred, h = 120)
forecast:::plot.forecast(press.pred2)
hist(residuals(press.pred2))

humid.vec <- as.vector(data.df$humid)
humid.ts <- ts(humid.vec, frequency = 8760)
humid.pred <- HoltWinters(humid.ts, beta = FALSE, gamma = FALSE)
humid.pred2 <- forecast:::forecast.HoltWinters(humid.pred, h = 120)
forecast:::plot.forecast(humid.pred2)
hist(residuals(humid.pred2))
```


You can also embed plots, for example:

```{r pressure, echo=FALSE}

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
