---
title: "Project draft"
author: "lucy and Jacob"
date: "4/5/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:



## RUN THIS BEFORE ANYTHING (initialization of data)
```{r}
library(ROCR)
library(class)

data.df <- read.csv("cleaned_data.csv")
set.seed(12345)
data.size <- nrow(data.df)
train.size <- .80
num.test.labels <- data.size*(1-train.size)


data.df$weather <- as.factor(data.df$weathertype)
levels(data.df$weathertype) <- c("Clear", "Clouds", "Rain", "Snow", "Thunderstorm")

normalize.it <- function(vec) {
    y <- (vec - min(vec))/(max(vec) - min(vec))
    y
}
    
weather.lst <- lapply(data.df[ , 3:8], normalize.it)
data.weather.normed <- data.frame(weather.lst)
summary(data.weather.normed)

train.row.nums <- sample(1:data.size, data.size*train.size, replace = FALSE)
train.data <- subset(data.weather.normed[train.row.nums, ])

test.row.nums <- setdiff(1:data.size, train.row.nums)
test.data <- subset(data.weather.normed[test.row.nums, ])

class.labels <- data.df$weathertype[train.row.nums]
true.labels <- data.df$weathertype[test.row.nums]

```


#KNN MODEL AND MISC RATE
```{r}
knn.predict <- knn(train.data, test.data, class.labels, k=5)

num.incorrect.labels <- sum(knn.predict != true.labels)
misc.rate <- num.incorrect.labels/num.test.labels
misc.rate

conf.matrix <- table(knn.predict, true.labels)
conf.matrix
```


## K-means
```{r}
library(fpc)
library(flexclust)
set.seed(12345)
fit.weathertest <- kmeans(data.df[,3:8], 5, nstart=25)
cont.table <- table(data.df$weathertype, fit.weathertest$cluster)
cont.table
chisq.test(cont.table)
newdf <- data.frame("temp" = c(284.415), "pressure"= c(1017.05), "humididty"= c(83), "windspeed" = c(2.71), "winddeg" = c(157.159), "cloudcov" = c(100))

clusterresults <- kcca(data.df[ ,3:8], k = 5)
barplot(clusterresults)
predclus <- predict(clusterresults, newdf)

clusters(clusterresults, data.df [,3:8])
```

#Time Series 
```{r}
library(ggplot2)
library(forecast)
#PREDICT TEMPERATURE
weather.vec <- as.vector(data.df$temp)
#remove outlier by averaging point before and after
weather.vec[3864:3865] <- ((weather.vec[3863]+weather.vec[3866])/2)
start <- 
end <- 
weather.ts <- ts(weather.vec, frequency = 8760, start = start, end = end)
plot.ts(weather.ts, main = "Temperature Time Series Graph", ylab = "Temperature in Kelvin")
weather.pred <- HoltWinters(weather.ts, beta = FALSE, gamma = FALSE)
weather.pred2 <- forecast:::forecast.HoltWinters(weather.pred, h=120)
forecast:::plot.forecast(weather.pred2)
hist(residuals(weather.pred2))
```
 

```{r} 
#PREDICT WINDSPEED
wind.vec <- as.vector(data.df$windspeed)
#remove outlier by averaging point before and after
#weather.vec[3864:3865] <- ((weather.vec[3863]+weather.vec[3866])/2)
wind.ts <- ts(wind.vec, frequency = 8760)
plot.ts(wind.ts, main = "Wind Speed Time Series Graph", ylab = "Wind Speed")
wind.pred <- HoltWinters(wind.ts, beta = FALSE, gamma = FALSE)
wind.pred2 <- forecast:::forecast.HoltWinters(wind.pred, h = 120)
forecast:::plot.forecast(wind.pred2)
hist(residuals(wind.pred2))
```

```{r}
#PREDICT AIR PRESSURE
pressure.vec <- as.vector(data.df$pressure)
pressure.vec[1097:1098] <- (pressure.vec[1096]+pressure.vec[1099])/2
pressure.vec[2417:2418] <- (pressure.vec[2416]+pressure.vec[2419])/2
pressure.vec[2587:2588] <- (pressure.vec[2586]+pressure.vec[2589])/2
pressure.ts <- ts(pressure.vec, frequency = 8760)
press.pred <- HoltWinters(pressure.ts, beta = FALSE, gamma = FALSE)
press.pred2 <- forecast:::forecast.HoltWinters(press.pred, h = 120)
forecast:::plot.forecast(press.pred2)
hist(residuals(press.pred2))
```

```{r}
#PREDICT HUMIDITY
humid.vec <- as.vector(data.df$humid)
humid.ts <- ts(humid.vec, frequency = 8760)
humid.pred <- HoltWinters(humid.ts, beta = FALSE, gamma = FALSE)
humid.pred2 <- forecast:::forecast.HoltWinters(humid.pred, h = 120)
forecast:::plot.forecast(humid.pred2)
hist(residuals(humid.pred2))
```


You can also embed plots, for example:

```{r pressure, echo=FALSE}

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
