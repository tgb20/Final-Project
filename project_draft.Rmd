---
title: "Project draft"
author: "lucy and Jacob"
date: "4/5/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:



## RUN THIS BEFORE ANYTHING (initialization of data)
```{r}
library(ROCR)
library(class)

data.df <- read.csv("cleaned_data.csv")
set.seed(12345)
data.size <- nrow(data.df)
train.size <- .80
num.test.labels <- data.size*(1-train.size)


data.df$weather <- as.factor(data.df$weathertype)
levels(data.df$weathertype) <- c("Clear", "Clouds", "Rain", "Snow", "Thunderstorm")

normalize.it <- function(vec) {
    y <- (vec - min(vec))/(max(vec) - min(vec))
    y
}
    
weather.lst <- lapply(data.df[ , 3:8], normalize.it)
data.weather.normed <- data.frame(weather.lst)
summary(data.weather.normed)

train.row.nums <- sample(1:data.size, data.size*train.size, replace = FALSE)
train.data <- subset(data.weather.normed[train.row.nums, ])

test.row.nums <- setdiff(1:data.size, train.row.nums)
test.data <- subset(data.weather.normed[test.row.nums, ])

class.labels <- data.df$weathertype[train.row.nums]
true.labels <- data.df$weathertype[test.row.nums]

```


#KNN MODEL AND MISC RATE
```{r}
knn.predict <- knn(train.data, test.data, class.labels, k=5)

num.incorrect.labels <- sum(knn.predict != true.labels)
misc.rate <- num.incorrect.labels/num.test.labels
misc.rate

conf.matrix <- table(knn.predict, true.labels)
conf.matrix
```


## K-means
```{r}
library(fpc)
library(flexclust)
set.seed(12345)
fit.weathertest <- kmeans(data.df[,3:8], 5, nstart=25)
cont.table <- table(data.df$weathertype, fit.weathertest$cluster)
cont.table
chisq.test(cont.table)
newdf <- data.frame("temp" = c(284.415), "pressure"= c(1017.05), "humididty"= c(83), "windspeed" = c(2.71), "winddeg" = c(157.159), "cloudcov" = c(100))

clusterresults <- kcca(data.df[ ,3:8], k = 5)
barplot(clusterresults)
predclus <- predict(clusterresults, newdf)

clusters(clusterresults, data.df [,3:8])
```

#Time Series 
```{r}
library(ggplot2)
library(forecast)
#PREDICT TEMPERATURE
weather.vec <- as.vector(data.df$temp)
#remove outlier by averaging point before and after
weather.vec[3864:3865] <- ((weather.vec[3863]+weather.vec[3866])/2)
start <- c(2012,10,1,14)
end <- c(2019,4,16,0)
weather.ts <- ts(weather.vec, frequency = 8760, start = start, end = end)
plot.ts(weather.ts, main = "Temperature Time Series Graph", ylab = "Temperature in Kelvin")
weather.pred <- HoltWinters(weather.ts)
weather.forecast <- forecast(weather.pred, h=120)
plot(weather.forecast)
subset.ts <- window(weather.ts, start = 2013.5, end = 2013.6)
plot.ts(subset.ts)

calcDate <- "2014-10-01 00:00:00 +0000 UTC"
dateRow <- which(data.df$dtiso == calcDate)
dataSubsetToDate <- data.df[1:dateRow,]
subWeather.vec <- as.vector(dataSubsetToDate$temp)
end <- c(2014,10,1,0)
newWeather.ts <- ts(subWeather.vec, frequency = 8760, start = start, end = end)
plot.ts(newWeather.ts)
weather.pred2 <- HoltWinters(newWeather.ts)
weather.forecast2 <- forecast(weather.pred2, h=120)
plot(weather.forecast2)
weather.forecast2

#data.df[which(data.df$dtiso == "2012-10-03 17:00:00 +0000 UTC"),]$weathertype
#weather.pred2 <- forecast:::forecast.HoltWinters(weather.pred, h=120)
#forecast:::plot.forecast(weather.pred2)
#hist(residuals(weather.pred2))


```
 

```{r} 
#PREDICT WINDSPEED
wind.vec <- as.vector(data.df$windspeed)
#remove outlier by averaging point before and after
#weather.vec[3864:3865] <- ((weather.vec[3863]+weather.vec[3866])/2)
start <- c(2012,10,1,14)
end <- c(2019,4,16,0)
wind.ts <- ts(wind.vec, frequency = 8760, start = start, end = end)
plot.ts(wind.ts, main = "Wind Speed Time Series Graph", ylab = "Wind Speed")

wind.pred <- HoltWinters(wind.ts)
wind.forecast <- forecast(wind.pred, h=120)
plot(wind.forecast)
subset.wind.ts <- window(wind.ts, start = 2013.5, end = 2013.6)
plot.ts(subset.wind.ts)

calcDate <- "2014-10-01 00:00:00 +0000 UTC"
dateRow <- which(data.df$dtiso == calcDate)
dataSubsetToDate <- data.df[1:dateRow,]
subWind.vec <- as.vector(dataSubsetToDate$windspeed)
end <- c(2014,10,1,0)

newWind.ts <- ts(subWind.vec, frequency = 8760, start = start, end = end)
plot.ts(newWind.ts)
wind.pred2 <- HoltWinters(newWind.ts)
wind.forecast2 <- forecast(wind.pred2, h=120)
plot(wind.forecast2)
wind.forecast2


```

```{r}
#PREDICT AIR PRESSURE
pressure.vec <- as.vector(data.df$pressure)
pressure.vec[1097:1098] <- (pressure.vec[1096]+pressure.vec[1099])/2
pressure.vec[2417:2418] <- (pressure.vec[2416]+pressure.vec[2419])/2
pressure.vec[2587:2588] <- (pressure.vec[2586]+pressure.vec[2589])/2
start <- c(2012,10,1,14)
end <- c(2019,4,16,0)

pressure.ts <- ts(pressure.vec, frequency = 8760, start = start, end = end)

pressure.pred <- HoltWinters(pressure.ts)
pressure.forecast <- forecast(pressure.pred, h=120)
plot(pressure.forecast)
subset.pressure.ts <- window(pressure.ts, start = 2013.5, end = 2013.6)
plot.ts(subset.pressure.ts)

calcDate <- "2014-10-01 00:00:00 +0000 UTC"
dateRow <- which(data.df$dtiso == calcDate)
dataSubsetToDate <- data.df[1:dateRow,]
subPress.vec <- as.vector(dataSubsetToDate$pressure)
end <- c(2014,10,1,0)
newPress.ts <- ts(subPress.vec, frequency = 8760, start = start, end = end)
plot.ts(newPress.ts)
pressure.pred2 <- HoltWinters(newPress.ts)
pressure.forecast2 <- forecast(pressure.pred2, h=120)
plot(pressure.forecast2)
pressure.forecast2
```

```{r}
#PREDICT HUMIDITY

start <- c(2012,10,1,14)
end <- c(2019,4,16,0)
humid.vec <- as.vector(data.df$humid)
humid.ts <- ts(humid.vec, frequency = 8760, start = start, end = end)

plot.ts(humid.ts, main = "Humidity Time Series Graph", ylab = "Humidity")
humid.pred <- HoltWinters(humid.ts)
humid.forecast <- forecast(humid.pred, h=120)
plot(humid.forecast)
subset.humid.ts <- window(humid.ts, start = 2013.5, end = 2013.6)
plot.ts(subset.humid.ts)

calcDate <- "2014-10-01 00:00:00 +0000 UTC"
dateRow <- which(data.df$dtiso == calcDate)
dataSubsetToDate <- data.df[1:dateRow,]
subHumid.vec <- as.vector(dataSubsetToDate$humid)
end <- c(2014,10,1,0)
newHumid.ts <- ts(subHumid.vec, frequency = 8760, start = start, end = end)
plot.ts(newHumid.ts)
humid.pred2 <- HoltWinters(newHumid.ts)
humid.forecast2 <- forecast(humid.pred2, h=120)
plot(humid.forecast2)
humid.forecast2
```


You can also embed plots, for example:

```{r pressure, echo=FALSE}

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
